// This is your Prisma schema file

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  JOB_SEEKER
  EMPLOYER
  ADMIN
}

enum ApplicationStatus {
  PENDING
  SHORTLISTED
  HIRED
  REJECTED
}

enum JobType {
  FULL_TIME
  PART_TIME
  INTERNSHIP
  FREELANCE
}

enum ExperienceLevel {
  ENTRY_LEVEL
  MID_LEVEL
  SENIOR
}

model User {
  id              String    @id @default(cuid())
  firebaseUid     String    @unique
  email           String    @unique
  role            UserRole  @default(JOB_SEEKER)
  isActive        Boolean   @default(true)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  profile         Profile?
  applications    Application[]
  savedJobs       SavedJob[]
  postedJobs      Job[]
  conversations   ConversationParticipant[]
  messages        Message[]
  notifications   Notification[]
  tickets         Ticket[]

  @@index([email])
  @@index([firebaseUid])
}

model Profile {
  id                    String    @id @default(cuid())
  userId                String    @unique
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  fullName              String
  bio                   String?
  headline              String?
  location              String?
  education             String?
  experienceLevel       String?
  skills                String[]  @default([])
  languages             String[]  @default([])
  preferredJobTypes     String[]  @default([])
  cvUrl                 String?
  profileImageUrl       String?
  
  onboardingCompleted   Boolean   @default(false)
  
  createdAt             DateTime  @default(now())
  updatedAt             DateTime  @updatedAt
}

model Company {
  id              String    @id @default(cuid())
  name            String
  website         String?
  description     String?
  logoUrl         String?
  location        String?
  isVerified      Boolean   @default(false)
  
  employerId      String    @unique
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

model Job {
  id              String           @id @default(cuid())
  title           String
  description     String
  type            JobType
  location        String
  experienceLevel ExperienceLevel
  salaryRange     String?
  tags            String[]         @default([])
  expiryDate      DateTime?
  isPromoted      Boolean          @default(false)
  status          String           @default("active")
  
  employerId      String
  employer        User             @relation(fields: [employerId], references: [id], onDelete: Cascade)
  
  applications    Application[]
  savedBy         SavedJob[]
  
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt

  @@index([employerId])
  @@index([type])
  @@index([location])
}

model Application {
  id              String            @id @default(cuid())
  status          ApplicationStatus @default(PENDING)
  message         String?
  
  jobId           String
  job             Job               @relation(fields: [jobId], references: [id], onDelete: Cascade)
  
  seekerId        String
  seeker          User              @relation(fields: [seekerId], references: [id], onDelete: Cascade)
  
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@unique([jobId, seekerId])
  @@index([jobId])
  @@index([seekerId])
}

model SavedJob {
  id              String    @id @default(cuid())
  
  userId          String
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  jobId           String
  job             Job       @relation(fields: [jobId], references: [id], onDelete: Cascade)
  
  createdAt       DateTime  @default(now())

  @@unique([userId, jobId])
  @@index([userId])
}

model FreelanceProject {
  id              String    @id @default(cuid())
  title           String
  description     String
  budget          String
  timeline        String
  tags            String[]  @default([])
  status          String    @default("open")
  
  clientId        String
  
  bids            FreelanceBid[]
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

model FreelanceBid {
  id              String    @id @default(cuid())
  amount          String
  proposal        String
  timeline        String
  status          String    @default("pending")
  
  projectId       String
  project         FreelanceProject @relation(fields: [projectId], references: [id], onDelete: Cascade)
  
  freelancerId    String
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([projectId])
  @@index([freelancerId])
}

model Conversation {
  id              String                      @id @default(cuid())
  lastMessageAt   DateTime                    @default(now())
  
  participants    ConversationParticipant[]
  messages        Message[]
  
  createdAt       DateTime                    @default(now())
  updatedAt       DateTime                    @updatedAt
}

model ConversationParticipant {
  id              String        @id @default(cuid())
  
  userId          String
  user            User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  conversationId  String
  conversation    Conversation  @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  
  joinedAt        DateTime      @default(now())

  @@unique([userId, conversationId])
  @@index([conversationId])
}

model Message {
  id              String        @id @default(cuid())
  content         String
  
  senderId        String
  sender          User          @relation(fields: [senderId], references: [id], onDelete: Cascade)
  
  conversationId  String
  conversation    Conversation  @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  
  createdAt       DateTime      @default(now())

  @@index([conversationId])
  @@index([senderId])
}

model Notification {
  id              String    @id @default(cuid())
  type            String
  text            String
  link            String?
  readAt          DateTime?
  
  userId          String
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  createdAt       DateTime  @default(now())

  @@index([userId])
}

model Ticket {
  id              String    @id @default(cuid())
  category        String
  description     String
  status          String    @default("open")
  
  userId          String
  user            User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  adminId         String?
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([userId])
  @@index([status])
}

model Payment {
  id              String    @id @default(cuid())
  amount          Decimal   @db.Decimal(10, 2)
  status          String
  
  jobId           String?
  employerId      String
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt
}

model Advertisement {
  id              String    @id @default(cuid())
  
  jobId           String
  employerId      String
  
  amount          Decimal   @db.Decimal(10, 2)
  startDate       DateTime
  endDate         DateTime
  
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  @@index([jobId])
}